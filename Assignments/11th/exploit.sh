#!/bin/bash

# Disable ASLR
echo 0 | sudo tee /proc/sys/kernel/randomize_va_space

# Compile target
gcc -g -fno-stack-protector -no-pie strcmp-target.c -o strcmp-target

# Compile hijack
gcc -fPIC -c strcmp-hijack.c -o strcmp-hijack.o -ldl
gcc -shared -o strcmp-hijack.so strcmp-hijack.o -ldl

# Test normal execution
echo "Testing normal execution..."
./strcmp-target wrongpass

# Test hijacked execution
echo "Testing hijacked execution..."
LD_PRELOAD=./strcmp-hijack.so ./strcmp-target wrongpass

# Test with GDB
echo "Starting GDB analysis..."
gdb -q --args env LD_PRELOAD=./strcmp-hijack.so ./strcmp-target wrongpass

